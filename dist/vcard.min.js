!function(e){function n(e){for(var n,r,a,f,u,c={},p=e.split(/\r\n|\r|\n/),l=p.length,s=0;s<l;s++)if(""!=p[s]&&p[s].toUpperCase()!=o&&p[s].toUpperCase()!=i){var h=p[s],v=function(e){return e+1<l&&(" "==p[e+1][0]||"\t"==p[e+1][0])};if(v(s))for(;v(s);)h+=p[s+1].trim(),s++;if(n=h.split(":"),r=n.shift(),a=n.join(":"),u=!1,f={},r.match(/;/)){r=r.replace(/\\;/g,"ΩΩΩ").replace(/\\,/,",");var g=r.split(";").map(function(e){return e.replace(/ΩΩΩ/g,";")});r=g.shift(),g.forEach(function(e){var n=e.split("=");n[0]=n[0].toLowerCase(),0!==n[0].length&&(f[n[0]]?f[n[0]].push(n[1]):f[n[0]]=[n[1]])})}if(a=a.replace(/\\n/g,"\n"),a=t(a),r.match(/\./)){var d=r.split(".");r=d[1],u=d[0]}var m={value:a};Object.keys(f).length&&(m.meta=f),u&&(m.namespace=u),0!==r.indexOf("X-")&&(r=r.toLowerCase()),"undefined"==typeof c[r]?c[r]=[m]:c[r].push(m)}return c}function t(e){return e.match(f)?(e=e.replace(/\\,/g,","),r(e,";")):e.match(u)?(e=e.replace(/\\;/g,";"),r(e,",")):e.replace(/\\,/g,",").replace(/\\;/g,";")}function r(e,n){var t=new RegExp(n),r=new RegExp("\\\\"+n,"g");return e=e.replace(r,"ΩΩΩ"),e.match(t)?(e=e.split(n),e=e.map(function(e){return e.replace(/ΩΩΩ/g,n)})):e=e.replace(/ΩΩΩ/g,n),e}function a(e,n){var t=[o],r="";n&&!e.version&&(e.version=[{value:"3.0"}]),n&&!e.uid&&(e.uid=[{value:c()}]);var a=function(e){return"undefined"==typeof e?"":e.replace(/\n/g,"\\n").replace(/;/g,"\\;").replace(/,/g,"\\,")};return Object.keys(e).forEach(function(n){e[n]&&"function"==typeof e[n].forEach&&e[n].forEach(function(e){if("undefined"!=typeof e.value&&""!=e.value){if(e.value instanceof Array){for(var o=!0,i=0;i<e.value.length;i++)if("undefined"!=typeof e.value[i]&&""!=e.value[i]){o=!1;break}if(o)return}if(r="",e.namespace&&(r+=e.namespace+"."),r+=0===n.indexOf("X-")?n:n.toUpperCase(),"object"==typeof e.meta&&Object.keys(e.meta).forEach(function(n){"function"==typeof e.meta[n].forEach&&e.meta[n].forEach(function(e){n.length>0&&(r+=";"+a(n.toUpperCase())+"="+a(e))})}),r+=":","string"==typeof e.value)r+=a(e.value);else{var f=p.indexOf(n)!==-1?",":";";r+=e.value.map(function(e){return a(e)}).join(f)}if(r.length>75){var u=r.substr(0,75),c=r.substr(75),l=c.match(/.{1,74}/g);t.push(u),l.forEach(function(e){t.push(" "+e)})}else t.push(r)}})}),t.push(i),t.join("\r\n")}var o="BEGIN:VCARD",i="END:VCARD",f=/[^\\];|^;/,u=/[^\\],|^,/,c=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),p=["nickname","related","categories","pid"];e.vCard={parse:n,generate:a}}("undefined"!=typeof window?window:module.exports);